import{z as _,c as p,b as F,d as T,e as $,f as j,i as k,g as v,h as y,k as M,l as N,r as w,t as q,j as c,F as E,m as A,n as C,o as L,p as B,I as P,q as U,s as I,B as R}from"./index-Cz0sLFk-.js";import{P as H}from"./index-CP8KZI2w.js";import{f as Q}from"./errorFormHandler-CQuQKGXn.js";const z=_.object({email:_.string().email({message:"Please enter a valid email address."}),password:_.string().min(6,{message:"Password must be at least 6 characters."})}),K=()=>{const e=p.c(8),t=F(O),n=T(V);let a;e[0]!==t||e[1]!==n?(a={mutationFn:D,onError:G,onSuccess:u=>{const{user:m,accessToken:f}=u;n(f),t(m),j.success("User logged in",{description:`The User ${m.userName} was successfully logged in`})}},e[0]=t,e[1]=n,e[2]=a):a=e[2];const{mutate:r,error:s,data:i,isPending:l}=$(a);let o;return e[3]!==s||e[4]!==l||e[5]!==r||e[6]!==i?(o={errorLogin:s,loginHandler:r,isLoading:l,userLogged:i},e[3]=s,e[4]=l,e[5]=r,e[6]=i,e[7]=o):o=e[7],o};function O(e){return e.setCurrentUser}function V(e){return e.setToken}async function D(e){return(await k.post("/login",e)).data}function G(){return j.error("User not logged in",{description:"There has been an error"})}const J=()=>{const e=p.c(12),t=v(),n=y(W),a=y(X);let r;e[0]!==n?(r=async()=>{const{data:f}=await k.post("mergeBaskets",n);return f},e[0]=n,e[1]=r):r=e[1];let s;e[2]!==t||e[3]!==a?(s=async f=>{a(f),t.refetchQueries({queryKey:["miniCart"]}),j.success("the shopping cart successfully updated.")},e[2]=t,e[3]=a,e[4]=s):s=e[4];let i;e[5]!==r||e[6]!==s?(i={mutationFn:r,onSuccess:s,onError:Y},e[5]=r,e[6]=s,e[7]=i):i=e[7];const{mutate:l,error:o,isPending:u}=$(i);let m;return e[8]!==o||e[9]!==l||e[10]!==u?(m={mergeShoppingCart:l,errorOnMergingCart:o,updatingShoppingCart:u},e[8]=o,e[9]=l,e[10]=u,e[11]=m):m=e[11],m};function W(e){return e.basket}function X(e){return e.setBasket}function Y(){return j.error("Error updating shopping cart.")}const Z={email:"",password:""},ee=()=>{const e=p.c(19),{loginHandler:t,errorLogin:n,isLoading:a}=K(),r=F(te),s=M(),{mergeShoppingCart:i}=J();let l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l={resolver:q(z),defaultValues:Z},e[0]=l):l=e[0];const o=N(l);let u;e[1]!==t?(u=function(S){t(S)},e[1]=t,e[2]=u):u=e[2];const m=u;let f;e[3]!==r||e[4]!==i||e[5]!==s?(f=()=>{r&&(i(),s("/profile"))},e[3]=r,e[4]=i,e[5]=s,e[6]=f):f=e[6];let d;e[7]!==r||e[8]!==s?(d=[r,s],e[7]=r,e[8]=s,e[9]=d):d=e[9],w.useEffect(f,d);let g,h;e[10]!==n||e[11]!==o?(g=()=>{if(n){const[b,S]=Q(n);o.setError(b,S)}},h=[n,o],e[10]=n,e[11]=o,e[12]=g,e[13]=h):(g=e[12],h=e[13]),w.useEffect(g,h);let x;return e[14]!==n||e[15]!==o||e[16]!==a||e[17]!==m?(x={form:o,onSubmit:m,errorLogin:n,isLoading:a},e[14]=n,e[15]=o,e[16]=a,e[17]=m,e[18]=x):x=e[18],x};function te(e){return e.currentUser}const se=()=>{var f;const e=p.c(16),{form:t,onSubmit:n}=ee();let a;e[0]!==t||e[1]!==n?(a=t.handleSubmit(n),e[0]=t,e[1]=n,e[2]=a):a=e[2];const r=`space-y-8 ${(f=t.formState.errors)!=null&&f.root?"text-destructive":""}`;let s,i;e[3]!==t.control?(s=c.jsx(E,{control:t.control,name:"email",render:re}),i=c.jsx(E,{control:t.control,name:"password",render:oe}),e[3]=t.control,e[4]=s,e[5]=i):(s=e[4],i=e[5]);let l,o;e[6]===Symbol.for("react.memo_cache_sentinel")?(l=c.jsx(I,{}),o=c.jsx(R,{type:"submit",className:"w-full",children:"Submit"}),e[6]=l,e[7]=o):(l=e[6],o=e[7]);let u;e[8]!==a||e[9]!==r||e[10]!==s||e[11]!==i?(u=c.jsxs("form",{onSubmit:a,className:r,children:[s,i,l,o]}),e[8]=a,e[9]=r,e[10]=s,e[11]=i,e[12]=u):u=e[12];let m;return e[13]!==t||e[14]!==u?(m=c.jsx(A,{...t,children:u}),e[13]=t,e[14]=u,e[15]=m):m=e[15],m};function re(e){const{field:t}=e;return c.jsxs(C,{children:[c.jsx(L,{children:"Email"}),c.jsx(B,{children:c.jsx(P,{placeholder:"E-mail",...t,autoComplete:"username"})}),c.jsx(U,{})]})}function oe(e){const{field:t}=e;return c.jsxs(C,{children:[c.jsx(L,{children:"Password"}),c.jsx(B,{children:c.jsx(P,{placeholder:"Password",type:"password",...t,autoComplete:"current-password"})}),c.jsx(U,{})]})}const ce=()=>{const e=p.c(1);let t;return e[0]===Symbol.for("react.memo_cache_sentinel")?(t=c.jsxs("article",{className:"flex flex-wrap flex-col max-w-md m-auto",children:[c.jsx(H,{title:"Login"}),c.jsx(se,{})]}),e[0]=t):t=e[0],t};export{ce as default};
